services:
  # Main Application Service
  - type: web
    name: shopping-assistant
    env: docker
    dockerfilePath: ./Dockerfile
    dockerContext: ./
    plan: free  # Free tier
    healthCheckPath: /health
    envVars:
      - key: AZURE_OPENAI_ENDPOINT
        value: https://azai-uaip-sandbox-eastus-001.openai.azure.com/
      - key: AZURE_OPENAI_API_VERSION
        value: 2024-12-01-preview
      - key: AZURE_OPENAI_API_KEY
        sync: false  # Set this as a secret in Render dashboard
      - key: ENABLE_REDIS
        value: true  # Enable Upstash Redis
      - key: ENABLE_NER
        value: true
      - key: REDIS_URL
        sync: false  # Set Upstash Redis URL as secret in Render dashboard
      - key: PORT
        value: 7860
      # Logging Configuration
      - key: LOG_LEVEL
        value: INFO  # Reduce log verbosity (INFO, WARNING, ERROR)
      - key: HIDE_LLM_PROMPTS
        value: true  # Hide verbose LLM prompts from logs
      # LangSmith Configuration for Evaluation and Tracing
      - key: LANGCHAIN_API_KEY
        sync: false  # Set this as a secret in Render dashboard
      - key: LANGCHAIN_PROJECT
        value: shopping-assistant-production
      - key: LANGCHAIN_TRACING_V2
        value: true
      - key: LANGCHAIN_ENDPOINT
        value: https://api.smith.langchain.com
    buildCommand: |
      echo "Building Shopping Assistant with Upstash Redis..."
    startCommand: python main.py prod
